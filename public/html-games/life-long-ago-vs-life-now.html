<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Time Capsule Sorter</title>
    <style>
        :root {
            --past-bg: #FDF5E6;
            --past-border: #8B4513;
            --present-bg: #E3F2FD;
            --present-border: #1565C0;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: none;
            color: var(--text-color);
        }

        /* --- HEADER --- */
        #header-bar {
            width: 100%;
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #444;
        }

        .score-box {
            font-weight: bold;
            color: #2E7D32;
            font-size: 1.2rem;
        }

        /* --- GAME BOARD --- */
        #game-board {
            flex: 1;
            width: 100%;
            display: flex;
            padding: 20px;
            gap: 20px;
            box-sizing: border-box;
            max-width: 1000px;
        }

        /* --- ZONES --- */
        .zone {
            flex: 1;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 4px dashed rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            overflow: hidden;
        }

        /* PAST ZONE STYLING */
        #zone-past {
            background-color: var(--past-bg);
            border-color: var(--past-border);
            /* Subtle parchment texture pattern via CSS radial gradient */
            background-image: radial-gradient(#e6dab8 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #zone-past .zone-label {
            background: var(--past-border);
            color: #FFF8DC;
        }

        /* PRESENT ZONE STYLING */
        #zone-present {
            background-color: var(--present-bg);
            border-color: var(--present-border);
            /* Tech grid pattern */
            background-image: linear-gradient(rgba(21, 101, 192, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(21, 101, 192, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        #zone-present .zone-label {
            background: var(--present-border);
            color: white;
        }

        .zone-label {
            text-align: center;
            padding: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 2;
        }

        .zone-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0.5;
            font-size: 5rem;
            /* Background Icon size */
            z-index: 1;
        }

        .zone.highlight {
            transform: scale(1.02);
            border-style: solid;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        /* --- PLAY PIECE --- */
        #stage-area {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 140px;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #current-item {
            width: 120px;
            height: 120px;
            cursor: grab;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.2));
            transition: transform 0.2s;
        }

        #current-item:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        /* The clone that moves */
        .flying-item {
            position: fixed;
            z-index: 1000;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }

        /* --- FACT MODAL --- */
        #fact-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #fact-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .fact-card {
            background: white;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-top: 10px solid #FFD700;
        }

        .fact-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 10px;
        }

        .fact-text {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        button.next-btn {
            background: #1565C0;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button.next-btn:hover {
            background: #0D47A1;
        }
    </style>
</head>

<body>

    <div id="header-bar">
        <h1>‚è≥ Time Capsule</h1>
        <div class="score-box">Score: <span id="score">0</span></div>
    </div>

    <div id="game-board">
        <div class="zone" id="zone-past">
            <div class="zone-label">Long Ago</div>
            <div class="zone-content">üìú</div>
        </div>

        <div class="zone" id="zone-present">
            <div class="zone-label">Life Now</div>
            <div class="zone-content">üíª</div>
        </div>
    </div>

    <div id="stage-area">
        <div id="current-item"></div>
    </div>

    <div id="fact-modal">
        <div class="fact-card">
            <h2 class="fact-title" id="fact-header">Correct!</h2>
            <div id="fact-icon" style="width: 80px; height: 80px; margin: 0 auto 15px auto;"></div>
            <p class="fact-text" id="fact-body">Did you know text goes here.</p>
            <button class="next-btn" onclick="nextLevel()">Next Item</button>
        </div>
    </div>

    <script>
        // --- SVG ASSETS (Drawn via code) ---
        const svgs = {
            quill: `<svg viewBox="0 0 100 100">
                <path d="M50,90 Q45,80 50,70 Q70,20 85,10 C90,5 95,5 90,15 Q80,30 75,40 Q70,50 50,90 Z" fill="#F5F5DC" stroke="#8B4513" stroke-width="2"/>
                <path d="M50,90 L40,95 L50,90 L60,95 Z" fill="#333"/>
                <path d="M50,70 L85,10" stroke="#D2B48C" stroke-width="1"/>
            </svg>`,
            laptop: `<svg viewBox="0 0 100 100">
                <rect x="20" y="20" width="60" height="45" rx="3" fill="#333"/>
                <rect x="23" y="23" width="54" height="39" fill="#81D4FA"/>
                <path d="M10,65 L90,65 L85,80 L15,80 Z" fill="#9E9E9E"/>
                <path d="M40,70 L60,70 L60,75 L40,75 Z" fill="#E0E0E0"/>
            </svg>`,
            candle: `<svg viewBox="0 0 100 100">
                <rect x="35" y="40" width="30" height="50" fill="#FFF8E1" stroke="#E0E0E0" stroke-width="1"/>
                <path d="M35,40 Q50,45 65,40" fill="#FFF8E1" stroke="#E0E0E0"/>
                <path d="M50,40 L50,25" stroke="#333" stroke-width="2"/>
                <path d="M50,25 Q60,15 50,5 Q40,15 50,25" fill="#FFC107">
                    <animate attributeName="d" values="M50,25 Q60,15 50,5 Q40,15 50,25; M50,25 Q65,15 50,2 Q35,15 50,25; M50,25 Q60,15 50,5 Q40,15 50,25" dur="0.5s" repeatCount="indefinite"/>
                </path>
            </svg>`,
            bulb: `<svg viewBox="0 0 100 100">
                <path d="M35,60 L35,80 L65,80 L65,60 Q80,50 80,35 Q80,10 50,10 Q20,10 20,35 Q20,50 35,60" fill="#FFF176" stroke="#FDD835" stroke-width="2"/>
                <path d="M35,80 L35,90 L65,90 L65,80" fill="#9E9E9E"/>
                <path d="M38,82 L62,82 M38,86 L62,86" stroke="#424242"/>
                <path d="M40,40 L50,30 L60,40" fill="none" stroke="#F57F17" stroke-width="2"/>
            </svg>`,
            well: `<svg viewBox="0 0 100 100">
                <ellipse cx="50" cy="85" rx="35" ry="10" fill="#795548"/>
                <path d="M15,85 L15,60 L85,60 L85,85" fill="#8D6E63" stroke="#5D4037" stroke-width="2"/>
                <rect x="10" y="55" width="80" height="10" fill="#5D4037"/>
                <rect x="25" y="20" width="5" height="40" fill="#5D4037"/>
                <rect x="70" y="20" width="5" height="40" fill="#5D4037"/>
                <path d="M20,20 L80,20 L50,5 Z" fill="#8D6E63"/>
                <line x1="50" y1="20" x2="50" y2="40" stroke="#333" stroke-width="1"/>
                <rect x="45" y="40" width="10" height="12" fill="#607D8B"/>
            </svg>`,
            tap: `<svg viewBox="0 0 100 100">
                <path d="M70,80 L70,30 L40,30 Q30,30 30,50 L30,60" fill="none" stroke="#90A4AE" stroke-width="12" stroke-linecap="round"/>
                <rect x="65" y="80" width="10" height="10" fill="#607D8B"/>
                <rect x="65" y="20" width="10" height="15" fill="#546E7A"/>
                <rect x="55" y="15" width="30" height="5" fill="#37474F"/>
                <path d="M30,65 Q30,85 25,95" stroke="#4FC3F7" stroke-width="3" fill="none" stroke-dasharray="5,2"/>
            </svg>`,
            carriage: `<svg viewBox="0 0 100 100">
                <rect x="25" y="30" width="50" height="40" rx="5" fill="#5D4037"/>
                <rect x="35" y="35" width="10" height="15" fill="#81D4FA"/>
                <rect x="55" y="35" width="10" height="15" fill="#81D4FA"/>
                <circle cx="25" cy="75" r="12" fill="none" stroke="#3E2723" stroke-width="3"/>
                <circle cx="75" cy="75" r="12" fill="none" stroke="#3E2723" stroke-width="3"/>
                <line x1="25" y1="75" x2="75" y2="75" stroke="#3E2723" stroke-width="2"/>
            </svg>`,
            car: `<svg viewBox="0 0 100 100">
                <path d="M10,65 L20,45 L70,45 L85,65 L90,65 Q95,65 95,75 L5,75 Q5,65 10,65" fill="#F44336"/>
                <path d="M25,48 L40,48 L40,60 L20,60 Z" fill="#B3E5FC"/>
                <path d="M45,48 L65,48 L75,60 L45,60 Z" fill="#B3E5FC"/>
                <circle cx="25" cy="75" r="8" fill="#333"/>
                <circle cx="75" cy="75" r="8" fill="#333"/>
            </svg>`
        };

        // --- GAME DATA ---
        const items = [
            { id: 'quill', name: 'Quill Pen', era: 'past', svg: svgs.quill, fact: "Before ballpoint pens, people dipped feathers (quills) into ink to write!" },
            { id: 'laptop', name: 'Laptop', era: 'present', svg: svgs.laptop, fact: "Computers help us work and play games anywhere we go today." },
            { id: 'candle', name: 'Candle', era: 'past', svg: svgs.candle, fact: "Long ago, there were no light switches. People carried candles to see in the dark." },
            { id: 'bulb', name: 'Light Bulb', era: 'present', svg: svgs.bulb, fact: "Electric lights let us see clearly at night just by flipping a switch." },
            { id: 'well', name: 'Water Well', era: 'past', svg: svgs.well, fact: "People used to lower buckets into deep holes called wells to get water." },
            { id: 'tap', name: 'Faucet', era: 'present', svg: svgs.tap, fact: "Today, clean water comes straight into our house through pipes!" },
            { id: 'carriage', name: 'Carriage', era: 'past', svg: svgs.carriage, fact: "Before cars, horses pulled wooden carriages to take people places." },
            { id: 'car', name: 'Electric Car', era: 'present', svg: svgs.car, fact: "Modern cars use engines or electricity to move fast on roads." }
        ];

        let queue = [];
        let score = 0;
        let currentItem = null;
        let isDragging = false;
        const synth = window.speechSynthesis;

        function initGame() {
            // Create a randomized queue
            queue = [...items].sort(() => Math.random() - 0.5);
            score = 0;
            updateScore();
            loadNext();
        }

        function loadNext() {
            if (queue.length === 0) {
                document.getElementById('fact-header').innerText = "Game Over!";
                document.getElementById('fact-body').innerText = "You sorted all the items perfectly! You are a Time Expert.";
                document.getElementById('fact-icon').innerHTML = "üèÜ";
                document.querySelector('.next-btn').innerText = "Play Again";
                document.querySelector('.next-btn').onclick = () => location.reload();
                document.getElementById('fact-modal').classList.add('show');

                // Notify parent window that game is complete
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({
                        type: 'html-game-complete',
                        game: 'life-long-ago-vs-life-now'
                    }, '*');
                }
                return;
            }

            currentItem = queue.pop();
            const el = document.getElementById('current-item');
            el.innerHTML = currentItem.svg;
            el.style.opacity = 1;

            // Speak item name
            speak(currentItem.name);

            // Add simple hover hint
            el.title = currentItem.name;
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
        }

        function speak(text) {
            // Try to use parent window TTS if available
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: text,
                    rate: 0.9,
                    pitch: 1.1
                }, '*');
            } else {
                if (synth.speaking) synth.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.rate = 1.1;
                synth.speak(u);
            }
        }

        // --- DRAG AND DROP LOGIC ---
        const itemEl = document.getElementById('current-item');
        let startX, startY;

        itemEl.addEventListener('mousedown', startDrag);
        itemEl.addEventListener('touchstart', startDrag, { passive: false });

        function startDrag(e) {
            e.preventDefault();
            isDragging = true;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            startX = clientX;
            startY = clientY;

            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchmove', onDrag, { passive: false });
            document.addEventListener('touchend', endDrag);
        }

        function onDrag(e) {
            if (!isDragging) return;
            e.preventDefault(); // Stop scrolling on touch

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const dx = clientX - startX;
            const dy = clientY - startY;

            itemEl.style.transform = `translate(${dx}px, ${dy}px) scale(1.1)`;
        }

        function endDrag(e) {
            isDragging = false;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchmove', onDrag);
            document.removeEventListener('touchend', endDrag);

            // Hit Detection
            const rect = itemEl.getBoundingClientRect();
            const center = { x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 };

            const pastZone = document.getElementById('zone-past').getBoundingClientRect();
            const presentZone = document.getElementById('zone-present').getBoundingClientRect();

            let choice = null;
            if (isInside(center, pastZone)) choice = 'past';
            else if (isInside(center, presentZone)) choice = 'present';

            if (choice) {
                if (choice === currentItem.era) {
                    handleSuccess(choice);
                } else {
                    handleFail(choice);
                }
            } else {
                // Return to start
                itemEl.style.transform = `translate(0, 0)`;
            }
        }

        function isInside(point, rect) {
            return point.x > rect.left && point.x < rect.right && point.y > rect.top && point.y < rect.bottom;
        }

        function handleSuccess(zoneId) {
            score++;
            updateScore();
            speak("Correct!");

            // 1. Create flying animation clone
            const clone = itemEl.cloneNode(true);
            const rect = itemEl.getBoundingClientRect();
            clone.classList.add('flying-item');
            clone.style.left = rect.left + 'px';
            clone.style.top = rect.top + 'px';
            document.body.appendChild(clone);

            // 2. Hide original immediately
            itemEl.style.opacity = 0;
            itemEl.style.transform = `translate(0,0)`;

            // 3. Move clone to center of target zone
            const target = document.getElementById(zoneId === 'past' ? 'zone-past' : 'zone-present').getBoundingClientRect();
            const destX = target.left + target.width / 2 - 60; // 60 is half width
            const destY = target.top + target.height / 2 - 60;

            setTimeout(() => {
                clone.style.transform = `translate(${destX - rect.left}px, ${destY - rect.top}px) scale(0)`;
                clone.style.opacity = 0;
            }, 10);

            // 4. Show Fact Modal
            setTimeout(() => {
                showFact();
                clone.remove();
            }, 600);
        }

        function handleFail(zoneId) {
            speak("Not quite. Try again.");
            itemEl.style.transform = `translate(0, 0)`;
            // Brief red shake effect could go here
            const zone = document.getElementById(zoneId === 'past' ? 'zone-past' : 'zone-present');
            zone.style.borderColor = 'red';
            setTimeout(() => zone.style.borderColor = '', 500);
        }

        function showFact() {
            const modal = document.getElementById('fact-modal');
            document.getElementById('fact-header').innerText = "That's Right!";
            document.getElementById('fact-body').innerText = currentItem.fact;
            document.getElementById('fact-icon').innerHTML = currentItem.svg;

            // Speak the fact
            speak(currentItem.fact);

            modal.classList.add('show');
        }

        function nextLevel() {
            document.getElementById('fact-modal').classList.remove('show');
            loadNext();
        }

        // Start
        initGame();

    </script>
</body>

</html>