<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern World - 1960s to 1990s Challenge</title>
    <style>
        :root {
            --primary: #1E88E5;
            --accent: #FF6F00;
            --bg: #E3F2FD;
            --card-bg: #FFFFFF;
            --tech: #00ACC1;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, var(--bg) 0%, #BBDEFB 100%);
            color: #333;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.8rem;
            margin: 10px 0;
            color: var(--primary);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 1.3rem;
            color: #666;
            font-style: italic;
        }

        /* Stage Indicator */
        #stage-indicator {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stage-badge {
            background: linear-gradient(135deg, var(--primary), #1565C0);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .score-display {
            background: #27AE60;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* Game Area */
        #game-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        /* Category Cards */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: linear-gradient(135deg, var(--card-bg), #F5F5F5);
            border: 4px solid var(--primary);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .category-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            box-shadow: 0 0 20px rgba(255,111,0,0.5);
        }

        .category-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* Feature Items */
        .feature-item {
            background: white;
            border: 3px solid #1E88E5;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            text-align: center;
        }

        .feature-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-color: var(--accent);
        }

        .feature-item.selected {
            background: #FFF3E0;
            border-color: var(--accent);
        }

        .feature-item.correct {
            background: #e8f5e9;
            border-color: #4CAF50;
        }

        .feature-item.wrong {
            background: #ffebee;
            border-color: #f44336;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Question Cards */
        .question-card {
            background: linear-gradient(135deg, var(--card-bg), #F5F5F5);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 25px;
            color: var(--primary);
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            text-align: center;
            font-weight: 500;
        }

        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border-color: var(--accent);
        }

        .option-btn.selected {
            background: #FFF3E0;
            border-color: var(--accent);
        }

        .option-btn.correct {
            background: #e8f5e9;
            border-color: #4CAF50;
            animation: celebrate 0.5s;
        }

        .option-btn.wrong {
            background: #ffebee;
            border-color: #f44336;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Timeline Visual */
        .timeline-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .timeline-event {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            border: 3px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 180px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-event:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .timeline-event.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, #FFE0B2, #FFCC80);
        }

        .timeline-year {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .timeline-event-name {
            font-size: 1rem;
            color: #666;
            line-height: 1.4;
        }

        /* Technology Matching */
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .tech-card {
            background: white;
            border: 3px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .tech-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .tech-card.selected {
            border-color: var(--accent);
            background: #FFF3E0;
        }

        .decade-zone {
            background: #F5F5F5;
            border: 3px dashed var(--primary);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            min-height: 150px;
        }

        .decade-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }

        /* Effects Grid */
        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .effect-card {
            background: white;
            border: 3px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .effect-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .effect-card.selected {
            border-color: var(--accent);
            background: #FFF3E0;
        }

        .effect-emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .effect-text {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            display: none;
            line-height: 1.6;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            border: 3px solid #4CAF50;
            color: #2E7D32;
        }

        .feedback.wrong {
            background: #ffebee;
            border: 3px solid #f44336;
            color: #c62828;
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 10px;
        }

        .btn:hover {
            background: #1565C0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-container {
            text-align: center;
            margin-top: 30px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-content h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .modal-content p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27AE60, #2ECC71);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Modern World - 1960s to 1990s Challenge üåê</h1>
            <p class="subtitle">From the Space Race to the Internet Revolution - a time of rapid change</p>
        </header>

        <div id="stage-indicator">
            <div class="stage-badge" id="stage-badge">Stage 1 of 6</div>
            <div class="score-display">Score: <span id="score">0</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%">0%</div>
            </div>
        </div>

        <div id="game-area">
            <!-- Game content will be dynamically inserted here -->
        </div>
    </div>

    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <h2>üéâ Congratulations! üéâ</h2>
            <p id="completion-message"></p>
            <button class="btn" onclick="closeModal()">Continue</button>
        </div>
    </div>

    <script>
        // Game Data - Advanced for Year 6
        const categories = {
            sixties: {
                name: 'The 1960s',
                emoji: '‚úåÔ∏è',
                features: [
                    { text: 'Time of social change and protests', correct: true },
                    { text: 'Space Race - Yuri Gagarin first in space (1961)', correct: true },
                    { text: 'Moon Landing - Apollo 11 (1969)', correct: true },
                    { text: 'Music and fashion changed dramatically', correct: true },
                    { text: 'Young people protested for change', correct: true },
                    { text: 'No technology advances', correct: false },
                    { text: 'Nothing changed', correct: false }
                ]
            },
            seventies: {
                name: 'The 1970s',
                emoji: 'üíæ',
                features: [
                    { text: 'Computers started to be developed', correct: true },
                    { text: 'Integrated circuits (IC chips) developed', correct: true },
                    { text: 'Space exploration continued', correct: true },
                    { text: 'Cassette tapes introduced for music', correct: true },
                    { text: 'More technology advances', correct: true },
                    { text: 'Computers were everywhere already', correct: false },
                    { text: 'No space exploration', correct: false }
                ]
            },
            eighties: {
                name: 'The 1980s',
                emoji: 'üíª',
                features: [
                    { text: 'Computers became common in offices and homes', correct: true },
                    { text: 'Technology grew rapidly', correct: true },
                    { text: 'Music and culture changed', correct: true },
                    { text: 'Personal computers (PCs) became popular', correct: true },
                    { text: 'Fall of Berlin Wall (1989)', correct: true },
                    { text: 'Computers were still rare', correct: false },
                    { text: 'No important events', correct: false }
                ]
            },
            nineties: {
                name: 'The 1990s',
                emoji: 'üåç',
                features: [
                    { text: 'Internet became popular and widespread', correct: true },
                    { text: 'Computers everywhere', correct: true },
                    { text: 'Communication changed dramatically', correct: true },
                    { text: 'World became connected through Internet', correct: true },
                    { text: 'End of Cold War (1991)', correct: true },
                    { text: 'Internet was not used', correct: false },
                    { text: 'World stayed disconnected', correct: false }
                ]
            },
            berlin: {
                name: 'Berlin Wall',
                emoji: 'üß±',
                features: [
                    { text: 'Built in 1961 to separate East and West Berlin', correct: true },
                    { text: 'Fell on November 9, 1989', correct: true },
                    { text: 'Separated communist East from democratic West', correct: true },
                    { text: 'Germany reunified on October 3, 1990', correct: true },
                    { text: 'Symbol of the Cold War division', correct: true },
                    { text: 'Was never built', correct: false },
                    { text: 'Still stands today', correct: false }
                ]
            },
            technology: {
                name: 'Technology Advances',
                emoji: 'üöÄ',
                features: [
                    { text: 'Space exploration - Moon landing, Mars missions', correct: true },
                    { text: 'Computers evolved from huge machines to personal computers', correct: true },
                    { text: 'Internet revolutionized communication', correct: true },
                    { text: 'Globalization - world became more connected', correct: true },
                    { text: 'Technology changed how people lived and worked', correct: true },
                    { text: 'Technology stayed the same', correct: false },
                    { text: 'No important inventions', correct: false }
                ]
            }
        };

        const advancedQuestions = [
            {
                question: "Who was the first person in space and when?",
                options: ["Neil Armstrong in 1969", "Yuri Gagarin in 1961 (Soviet Union)", "John Glenn in 1962", "Buzz Aldrin in 1969"],
                correct: 1,
                explanation: "Yuri Gagarin from the Soviet Union was the first person in space in 1961! This was a major achievement in the Space Race between the USA and Soviet Union!"
            },
            {
                question: "When did humans first land on the Moon?",
                options: ["1961", "1965", "1969 with Apollo 11", "1975"],
                correct: 2,
                explanation: "Humans first landed on the Moon in 1969 with Apollo 11! Neil Armstrong and Buzz Aldrin became the first humans to walk on the Moon!"
            },
            {
                question: "When did the Berlin Wall fall?",
                options: ["1961", "1980", "November 9, 1989", "1991"],
                correct: 2,
                explanation: "The Berlin Wall fell on November 9, 1989! This was a momentous event that led to Germany's reunification in 1990 and symbolized the end of the Cold War!"
            },
            {
                question: "What was the Berlin Wall?",
                options: ["A decoration", "A wall built in 1961 to separate communist East Berlin from democratic West Berlin", "A type of building", "A bridge"],
                correct: 1,
                explanation: "The Berlin Wall was built in 1961 to separate communist East Berlin from democratic West Berlin! It became a powerful symbol of the Cold War division!"
            },
            {
                question: "When did computers become common?",
                options: ["1960s", "1970s (started), 1980s (became common)", "1990s only", "2000s"],
                correct: 1,
                explanation: "Computers started being developed in the 1970s, but became common in offices and homes during the 1980s! Personal computers (PCs) became popular then!"
            },
            {
                question: "When did the Internet become popular?",
                options: ["1970s", "1980s", "1990s", "2000s"],
                correct: 2,
                explanation: "The Internet became popular and widespread in the 1990s! This revolutionized communication and connected the world in ways never seen before!"
            },
            {
                question: "What was the Space Race?",
                options: ["A running competition", "A competition between USA and Soviet Union to achieve space exploration milestones", "A type of car race", "A game"],
                correct: 1,
                explanation: "The Space Race was a competition between the USA and Soviet Union to achieve space exploration milestones! It included first person in space, first Moon landing, and many other achievements!"
            },
            {
                question: "When did the Cold War end?",
                options: ["1989", "1990", "1991", "1992"],
                correct: 2,
                explanation: "The Cold War ended in 1991! The fall of the Berlin Wall in 1989 and the collapse of the Soviet Union in 1991 marked the end of this long period of tension!"
            },
            {
                question: "What was globalization?",
                options: ["A type of food", "The process of the world becoming more connected through technology, trade, and communication", "A country", "A type of music"],
                correct: 1,
                explanation: "Globalization was the process of the world becoming more connected through technology, trade, and communication! The Internet played a huge role in making this happen!"
            },
            {
                question: "How did technology change life from 1960s to 1990s?",
                options: ["It didn't change", "Technology advanced from space exploration to personal computers to the Internet, changing how people lived, worked, and communicated", "Only computers changed", "Only space changed"],
                correct: 1,
                explanation: "Technology advanced dramatically! From space exploration in the 1960s, to computers starting in the 1970s, becoming common in the 1980s, to the Internet revolutionizing everything in the 1990s - it completely changed how people lived, worked, and communicated!"
            }
        ];

        const timelineEvents = [
            { year: '1961', event: 'Yuri Gagarin first person in space', order: 1 },
            { year: '1969', event: 'Apollo 11 - First Moon landing', order: 2 },
            { year: '1970s', event: 'Computers start being developed', order: 3 },
            { year: '1980s', event: 'Computers become common', order: 4 },
            { year: '1989', event: 'Berlin Wall falls', order: 5 },
            { year: '1990', event: 'Germany reunifies', order: 6 },
            { year: '1991', event: 'Cold War ends', order: 7 },
            { year: '1990s', event: 'Internet becomes popular', order: 8 }
        ];

        const effects = [
            { effect: 'World became more connected through technology', correct: true, emoji: 'üåç' },
            { effect: 'Communication changed dramatically with Internet', correct: true, emoji: 'üì°' },
            { effect: 'Space exploration advanced human knowledge', correct: true, emoji: 'üöÄ' },
            { effect: 'Cold War ended, Berlin Wall fell', correct: true, emoji: 'üß±' },
            { effect: 'Computers changed how people worked and lived', correct: true, emoji: 'üíª' },
            { effect: 'Nothing changed during this period', correct: false, emoji: '‚ùå' },
            { effect: 'Technology stayed the same', correct: false, emoji: 'üì∫' },
            { effect: 'World became less connected', correct: false, emoji: 'üîí' }
        ];

        // Game State
        let currentStage = 1;
        let score = 0;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let selectedCategory = null;
        let selectedFeatures = new Set();
        let selectedTimelineOrder = [];
        let selectedEffects = new Set();

        // Initialize Game
        function initGame() {
            currentStage = 1;
            score = 0;
            totalQuestions = 0;
            correctAnswers = 0;
            updateScore();
            loadStage(1);
        }

        function loadStage(stage) {
            currentStage = stage;
            const gameArea = document.getElementById('game-area');
            gameArea.innerHTML = '';

            updateStageIndicator();

            switch(stage) {
                case 1:
                    loadStage1();
                    break;
                case 2:
                    loadStage2();
                    break;
                case 3:
                    loadStage3();
                    break;
                case 4:
                    loadStage4();
                    break;
                case 5:
                    loadStage5();
                    break;
                case 6:
                    loadStage6();
                    break;
            }
        }

        function loadStage1() {
            const gameArea = document.getElementById('game-area');
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 1: Match Features to Categories</h2>';
            html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem;">Select a category, then click on ALL the features that belong to it!</p>';
            
            html += '<div class="category-grid">';
            Object.keys(categories).forEach(key => {
                const cat = categories[key];
                html += `
                    <div class="category-card" data-category="${key}" onclick="selectCategory('${key}')">
                        <div class="category-emoji">${cat.emoji}</div>
                        <div class="category-name">${cat.name}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += '<div id="features-section" style="display: none;">';
            html += '<h3 style="text-align: center; margin: 30px 0 20px 0; font-size: 1.4rem;">Click on ALL the features that belong to this category:</h3>';
            html += '<div id="features-container"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" onclick="checkStage1()">Check Answers</button>';
            html += '</div>';
            html += '</div>';
            
            html += '<div id="feedback" class="feedback"></div>';
            
            gameArea.innerHTML = html;
            selectedFeatures.clear();
        }

        function selectCategory(categoryKey) {
            selectedCategory = categoryKey;
            const cards = document.querySelectorAll('.category-card');
            cards.forEach(card => card.classList.remove('selected'));
            document.querySelector(`[data-category="${categoryKey}"]`).classList.add('selected');
            
            const featuresSection = document.getElementById('features-section');
            const featuresContainer = document.getElementById('features-container');
            
            // Get all features and shuffle
            const allFeatures = [];
            Object.keys(categories).forEach(key => {
                categories[key].features.forEach(feature => {
                    allFeatures.push({ text: feature.text, correct: key === categoryKey && feature.correct, category: key });
                });
            });
            
            const shuffled = allFeatures.sort(() => Math.random() - 0.5);
            
            featuresContainer.innerHTML = '';
            shuffled.forEach((feature, index) => {
                const featureCard = document.createElement('div');
                featureCard.className = 'feature-item';
                featureCard.textContent = feature.text;
                featureCard.dataset.index = index;
                featureCard.dataset.correct = feature.correct;
                featureCard.onclick = () => toggleFeature(index);
                featuresContainer.appendChild(featureCard);
            });
            
            featuresSection.style.display = 'block';
        }

        function toggleFeature(index) {
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                selectedFeatures.delete(index);
            } else {
                card.classList.add('selected');
                selectedFeatures.add(index);
            }
        }

        function checkStage1() {
            const cards = document.querySelectorAll('.feature-item');
            let correct = 0;
            let totalCorrect = categories[selectedCategory].features.filter(f => f.correct).length;
            
            cards.forEach(card => {
                const isCorrect = card.dataset.correct === 'true';
                const isSelected = card.classList.contains('selected');
                
                if (isCorrect && isSelected) {
                    correct++;
                    card.classList.add('correct');
                } else if (isCorrect && !isSelected) {
                    card.classList.add('correct');
                } else if (!isCorrect && isSelected) {
                    card.classList.add('wrong');
                }
            });
            
            const feedback = document.getElementById('feedback');
            if (correct === totalCorrect && selectedFeatures.size === totalCorrect) {
                feedback.textContent = `‚úì Perfect! You found all ${totalCorrect} correct features for ${categories[selectedCategory].name}!`;
                feedback.className = 'feedback show correct';
                score += 35;
                correctAnswers += totalCorrect;
            } else {
                feedback.textContent = `You found ${correct} out of ${totalCorrect} correct features. Keep trying!`;
                feedback.className = 'feedback show wrong';
                correctAnswers += correct;
            }
            
            totalQuestions += cards.length;
            updateScore();
            
            setTimeout(() => {
                if (currentStage < 6) {
                    loadStage(currentStage + 1);
                } else {
                    endGame();
                }
            }, 3000);
            
            // Send TTS
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: feedback.textContent,
                    rate: 0.85,
                    pitch: 1.0
                }, '*');
            }
        }

        function loadStage2() {
            const gameArea = document.getElementById('game-area');
            const question = advancedQuestions[Math.floor(Math.random() * advancedQuestions.length)];
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 2: Advanced Knowledge Challenge</h2>';
            html += '<div class="question-card">';
            html += `<div class="question-text">${question.question}</div>`;
            html += '<div class="options-grid">';
            
            question.options.forEach((option, index) => {
                html += `<button class="option-btn" data-index="${index}" onclick="selectOption(${index}, ${question.correct}, '${question.explanation.replace(/'/g, "\\'")}')">${option}</button>`;
            });
            
            html += '</div></div>';
            html += '<div id="feedback" class="feedback"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" id="next-stage2" onclick="nextStage2()" style="display: none;">Continue</button>';
            html += '</div>';
            
            gameArea.innerHTML = html;
        }

        function selectOption(selectedIndex, correctIndex, explanation) {
            const buttons = document.querySelectorAll('.option-btn');
            const feedback = document.getElementById('feedback');
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (selectedIndex === correctIndex) {
                buttons[selectedIndex].classList.add('correct');
                feedback.textContent = '‚úì Correct! ' + explanation;
                feedback.className = 'feedback show correct';
                score += 25;
                correctAnswers++;
            } else {
                buttons[selectedIndex].classList.add('wrong');
                buttons[correctIndex].classList.add('correct');
                feedback.textContent = '‚úó Not quite. ' + explanation;
                feedback.className = 'feedback show wrong';
            }
            
            totalQuestions++;
            updateScore();
            
            document.getElementById('next-stage2').style.display = 'inline-block';
            
            // Send TTS
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: feedback.textContent,
                    rate: 0.85,
                    pitch: 1.0
                }, '*');
            }
        }

        function nextStage2() {
            if (currentStage < 6) {
                loadStage(currentStage + 1);
            } else {
                endGame();
            }
        }

        function loadStage3() {
            const gameArea = document.getElementById('game-area');
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 3: Modern World Timeline</h2>';
            html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem;">Put these critical events in the correct chronological order!</p>';
            
            const shuffledEvents = [...timelineEvents].sort(() => Math.random() - 0.5);
            
            html += '<div class="timeline-container">';
            shuffledEvents.forEach((event, index) => {
                html += `
                    <div class="timeline-event" data-year="${event.year}" data-order="${event.order}" onclick="selectTimelineEvent('${event.year}', ${event.order})">
                        <div class="timeline-year">${event.year}</div>
                        <div class="timeline-event-name">${event.event}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += '<div id="selected-timeline" style="margin-top: 30px; min-height: 60px; padding: 15px; background: #E3F2FD; border-radius: 10px; border: 2px dashed var(--primary); text-align: center;"></div>';
            
            html += '<div id="feedback" class="feedback"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" onclick="checkStage3()">Check Order</button>';
            html += '</div>';
            
            gameArea.innerHTML = html;
            selectedTimelineOrder = [];
        }

        function selectTimelineEvent(year, order) {
            const event = document.querySelector(`[data-year="${year}"]`);
            const existingIndex = selectedTimelineOrder.findIndex(e => e.year === year);
            
            if (existingIndex !== -1) {
                selectedTimelineOrder.splice(existingIndex, 1);
                event.classList.remove('selected');
            } else {
                selectedTimelineOrder.push({ year, order });
                event.classList.add('selected');
            }
            
            updateTimelineDisplay();
        }

        function updateTimelineDisplay() {
            const display = document.getElementById('selected-timeline');
            if (selectedTimelineOrder.length === 0) {
                display.innerHTML = '<p style="color: #666; font-style: italic;">Click events in chronological order...</p>';
            } else {
                display.innerHTML = selectedTimelineOrder.map((e, i) => 
                    `${i + 1}. ${e.year}`
                ).join(' ‚Üí ');
            }
        }

        function checkStage3() {
            const correctOrder = [1, 2, 3, 4, 5, 6, 7, 8];
            const selectedOrder = selectedTimelineOrder.map(e => e.order);
            const isCorrect = JSON.stringify(selectedOrder) === JSON.stringify(correctOrder);
            
            const feedback = document.getElementById('feedback');
            if (isCorrect && selectedTimelineOrder.length === 8) {
                feedback.textContent = '‚úì Perfect! The correct order is: 1961 (Gagarin in space) ‚Üí 1969 (Moon landing) ‚Üí 1970s (Computers start) ‚Üí 1980s (Computers common) ‚Üí 1989 (Berlin Wall falls) ‚Üí 1990 (Germany reunifies) ‚Üí 1991 (Cold War ends) ‚Üí 1990s (Internet popular)!';
                feedback.className = 'feedback show correct';
                score += 40;
                correctAnswers += 8;
            } else {
                feedback.textContent = 'Not quite. The correct order is: 1961 ‚Üí 1969 ‚Üí 1970s ‚Üí 1980s ‚Üí 1989 ‚Üí 1990 ‚Üí 1991 ‚Üí 1990s. Try again!';
                feedback.className = 'feedback show wrong';
            }
            
            totalQuestions += 8;
            updateScore();
            
            setTimeout(() => {
                if (currentStage < 6) {
                    loadStage(currentStage + 1);
                } else {
                    endGame();
                }
            }, 3000);
            
            // Send TTS
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: feedback.textContent,
                    rate: 0.85,
                    pitch: 1.0
                }, '*');
            }
        }

        function loadStage4() {
            const gameArea = document.getElementById('game-area');
            const question = advancedQuestions[Math.floor(Math.random() * advancedQuestions.length)];
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 4: Technology Evolution</h2>';
            html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem;">Test your understanding of how technology evolved!</p>';
            html += '<div class="question-card">';
            html += `<div class="question-text">${question.question}</div>`;
            html += '<div class="options-grid">';
            
            question.options.forEach((option, index) => {
                html += `<button class="option-btn" data-index="${index}" onclick="selectOption(${index}, ${question.correct}, '${question.explanation.replace(/'/g, "\\'")}')">${option}</button>`;
            });
            
            html += '</div></div>';
            html += '<div id="feedback" class="feedback"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" id="next-stage4" onclick="nextStage4()" style="display: none;">Continue</button>';
            html += '</div>';
            
            gameArea.innerHTML = html;
        }

        function nextStage4() {
            if (currentStage < 6) {
                loadStage(currentStage + 1);
            } else {
                endGame();
            }
        }

        function loadStage5() {
            const gameArea = document.getElementById('game-area');
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 5: Effects of the Modern World</h2>';
            html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem;">Select ALL the real effects and consequences of this period!</p>';
            
            const shuffledEffects = effects.sort(() => Math.random() - 0.5);
            
            html += '<div class="effects-grid">';
            shuffledEffects.forEach((effect, index) => {
                html += `
                    <div class="effect-card" data-index="${index}" data-correct="${effect.correct}" onclick="toggleEffect(${index}, ${effect.correct})">
                        <div class="effect-emoji">${effect.emoji}</div>
                        <div class="effect-text">${effect.effect}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += '<div id="feedback" class="feedback"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" onclick="checkStage5()">Check Answers</button>';
            html += '</div>';
            
            gameArea.innerHTML = html;
            selectedEffects.clear();
        }

        function toggleEffect(index, isCorrect) {
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                selectedEffects.delete(index);
            } else {
                card.classList.add('selected');
                selectedEffects.add(index);
            }
        }

        function checkStage5() {
            const cards = document.querySelectorAll('.effect-card');
            let correct = 0;
            let totalCorrect = 5; // 5 correct effects
            
            cards.forEach(card => {
                const isCorrect = card.dataset.correct === 'true';
                const isSelected = card.classList.contains('selected');
                
                if (isCorrect && isSelected) {
                    correct++;
                    card.style.borderColor = '#4CAF50';
                    card.style.background = '#e8f5e9';
                } else if (isCorrect && !isSelected) {
                    card.style.borderColor = '#4CAF50';
                    card.style.background = '#e8f5e9';
                } else if (!isCorrect && isSelected) {
                    card.style.borderColor = '#f44336';
                    card.style.background = '#ffebee';
                }
            });
            
            const feedback = document.getElementById('feedback');
            if (correct === totalCorrect && selectedEffects.size === totalCorrect) {
                feedback.textContent = `‚úì Perfect! You found all ${totalCorrect} correct effects! This period had major impacts: the world became more connected, communication changed dramatically with the Internet, space exploration advanced human knowledge, the Cold War ended, and computers changed how people worked and lived!`;
                feedback.className = 'feedback show correct';
                score += 35;
                correctAnswers += totalCorrect;
            } else {
                feedback.textContent = `You found ${correct} out of ${totalCorrect} correct effects. Remember: This period connected the world, revolutionized communication, advanced space exploration, ended the Cold War, and changed how people worked with computers!`;
                feedback.className = 'feedback show wrong';
                correctAnswers += correct;
            }
            
            totalQuestions += cards.length;
            updateScore();
            
            setTimeout(() => {
                if (currentStage < 6) {
                    loadStage(currentStage + 1);
                } else {
                    endGame();
                }
            }, 3000);
            
            // Send TTS
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: feedback.textContent,
                    rate: 0.85,
                    pitch: 1.0
                }, '*');
            }
        }

        function loadStage6() {
            const gameArea = document.getElementById('game-area');
            const question = advancedQuestions[Math.floor(Math.random() * advancedQuestions.length)];
            
            let html = '<h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--primary);">Stage 6: Final Challenge</h2>';
            html += '<p style="text-align: center; margin-bottom: 20px; font-size: 1.2rem; color: #666;">One final advanced question to test your deep understanding!</p>';
            html += '<div class="question-card">';
            html += `<div class="question-text">${question.question}</div>`;
            html += '<div class="options-grid">';
            
            question.options.forEach((option, index) => {
                html += `<button class="option-btn" data-index="${index}" onclick="selectOption(${index}, ${question.correct}, '${question.explanation.replace(/'/g, "\\'")}')">${option}</button>`;
            });
            
            html += '</div></div>';
            html += '<div id="feedback" class="feedback"></div>';
            html += '<div class="btn-container">';
            html += '<button class="btn" id="next-stage6" onclick="endGame()" style="display: none;">Finish Game</button>';
            html += '</div>';
            
            gameArea.innerHTML = html;
        }

        function updateStageIndicator() {
            document.getElementById('stage-badge').textContent = `Stage ${currentStage} of 6`;
            const progress = (currentStage / 6) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-fill').textContent = Math.round(progress) + '%';
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        function endGame() {
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            let message = '';
            
            if (percentage >= 90) {
                message = `Outstanding! You scored ${score} points with ${percentage}% correct! You're a true expert on the Modern World! üèÜ`;
            } else if (percentage >= 75) {
                message = `Excellent! You scored ${score} points with ${percentage}% correct! You have a strong understanding of this transformative period! üåü`;
            } else if (percentage >= 60) {
                message = `Good work! You scored ${score} points with ${percentage}% correct! Keep studying to deepen your understanding! üìö`;
            } else {
                message = `You scored ${score} points with ${percentage}% correct. Review the lesson and try again! This is complex history - keep learning! üí™`;
            }
            
            document.getElementById('completion-message').textContent = message;
            document.getElementById('completion-modal').classList.add('show');
            
            // Send completion message
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: message,
                    rate: 0.9,
                    pitch: 1.0
                }, '*');
                
                setTimeout(() => {
                    window.parent.postMessage({
                        type: 'html-game-complete',
                        game: 'modern-world-1960s-1990s'
                    }, '*');
                }, 3000);
            }
        }

        function closeModal() {
            document.getElementById('completion-modal').classList.remove('show');
        }

        // Initialize on load
        window.onload = initGame;
    </script>
</body>
</html>
