<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pharaoh's Treasure Hunt</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
            /* A sandy, tomb-like gradient background */
            background: linear-gradient(to bottom, #C2B280, #E6D8AD);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            padding: 10px;
            overflow: hidden;
            touch-action: manipulation;
            color: #5D4037;
        }

        h1 {
            text-shadow: 2px 2px 0px #FFD700;
            font-size: clamp(1.2rem, 4vmin, 2rem);
            margin: 5px 0;
            text-align: center;
            flex-shrink: 0;
        }

        /* Decorative Hieroglyph Banner */
        .hieroglyphs {
            font-size: clamp(1rem, 3vmin, 2rem);
            letter-spacing: 10px;
            opacity: 0.6;
            margin-bottom: 10px;
            user-select: none;
            flex-shrink: 0;
        }

        /* --- SCOREBOARD --- */
        #scoreboard {
            background: rgba(255, 215, 0, 0.3); /* Sheer gold */
            border: 3px solid #FFD700;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: clamp(1rem, 3vmin, 1.5rem);
            font-weight: bold;
            margin-bottom: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        #score-count { color: #d32f2f; }

        .tap-hint {
            font-size: clamp(0.9rem, 2.5vmin, 1.2rem);
            margin: 5px 0;
            flex-shrink: 0;
        }

        /* --- THE TOMB CONTAINER --- */
        #tomb-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: clamp(5px, 1.5vmin, 15px);
            max-width: min(800px, 95vw);
            width: 100%;
            flex: 1;
            min-height: 0;
            perspective: 1000px; /* For 3D flip effect */
        }

        /* --- HIDING SPOTS --- */
        .hiding-spot {
            background-color: #8D6E63; /* Clay/Stone color */
            border-radius: clamp(8px, 2vmin, 15px);
            border: 3px solid #5D4037;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1.5rem, 6vmin, 3.5rem);
            cursor: pointer;
            box-shadow: 0 4px 0 #3E2723;
            transition: transform 0.1s;
            position: relative;
            overflow: hidden;
            min-height: 0;
        }

        .hiding-spot:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #3E2723;
        }

        /* The content inside */
        .spot-content {
            transition: all 0.5s ease-out;
        }

        /* Animation classes applied by JS */
        .hiding-spot.revealed .container-icon {
            display: none;
        }

        .reveal-anim {
            animation: popUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popUp {
            0% { transform: scale(0) translateY(50px); opacity: 0; }
            70% { transform: scale(1.2) translateY(-10px); opacity: 1; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }

        /* --- WIN SCREEN --- */
        #win-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100;
            visibility: hidden; opacity: 0;
            transition: opacity 0.5s;
            text-align: center;
            padding: 20px;
        }
        #win-screen.show { visibility: visible; opacity: 1; }
        #win-screen h2 {
            font-size: clamp(1.5rem, 6vmin, 3rem);
            color: #DAA520;
            margin: 0;
        }
        #win-screen .win-icons {
            font-size: clamp(3rem, 10vmin, 6rem);
            margin: 15px 0;
        }
        #win-screen p {
            font-size: clamp(1rem, 3vmin, 1.5rem);
        }

        button.reset-btn {
            background-color: #FFD700; color: #5D4037;
            border: 4px solid #DAA520;
            padding: clamp(10px, 2vmin, 15px) clamp(25px, 5vmin, 40px);
            font-size: clamp(1rem, 3vmin, 1.5rem);
            border-radius: 50px;
            margin-top: 15px; cursor: pointer; font-weight: bold;
            box-shadow: 0 6px 0 #B8860B;
        }
        button.reset-btn:active { transform: translateY(6px); box-shadow: none; }

        canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:99; }

    </style>
</head>
<body>

    <h1>üê™ Pharaoh's Tomb üê™</h1>
    <div class="hieroglyphs">üëÅÔ∏è‚Äçüó®Ô∏èìÄÄìÅÉìÉ†ìÜ£ìâ¥</div>
    
    <div id="scoreboard">Treasures Found: <span id="score-count">0</span> / 3</div>
    <p class="tap-hint">Tap to open!</p>

    <div id="tomb-container">
        </div>

    <div id="win-screen">
        <h2>YOU WIN!</h2>
        <div class="win-icons">üëëüíé‚ö±Ô∏è</div>
        <p>You found the Pharaoh's gold!</p>
        <button class="reset-btn" onclick="initGame()">Play Again</button>
    </div>

    <canvas id="confetti"></canvas>

    <script>
        // The things inside the tomb
        const possibleItems = [
            { type: 'treasure', icon: 'üíé', name: 'A shiny jewel!' },
            { type: 'treasure', icon: 'üëë', name: 'The Pharaoh\'s crown!' },
            { type: 'treasure', icon: 'üè∫', name: 'A golden jar!' },
            { type: 'treasure', icon: 'ìÜ£', name: 'A golden beetle!' },
            { type: 'treasure', icon: 'üêà‚Äç‚¨õ', name: 'A royal cat!' },
            { type: 'treasure', icon: '‚ö±Ô∏è', name: 'A golden vase!' },
            { type: 'treasure', icon: 'üóø', name: 'An ancient statue!' },
            // The "silly" items that don't give points
            { type: 'dust', icon: 'ü§ï', name: 'Oh! A silly mummy!' },
            { type: 'dust', icon: 'üí®', name: 'Just dusty sand!' },
            { type: 'dust', icon: 'üï∑Ô∏è', name: 'A spider!' },
            { type: 'dust', icon: 'ü¶Ç', name: 'A scorpion!' },
            { type: 'dust', icon: 'ü™®', name: 'Just a rock!' },
            { type: 'dust', icon: 'ü¶¥', name: 'An old bone!' },
            { type: 'dust', icon: 'ü™±', name: 'A worm!' },
            { type: 'dust', icon: 'üï∏Ô∏è', name: 'A cobweb!' },
            { type: 'dust', icon: 'üåµ', name: 'A cactus!' }
        ];

        // The containers they click on (12 different containers)
        const containers = ['‚ö∞Ô∏è', 'üì¶', 'üèúÔ∏è', 'üß±', 'üóø', 'üè∫', 'üìú', 'üóÑÔ∏è', 'üï≥Ô∏è', 'üèõÔ∏è', 'üî±', '‚ö°'];

        let treasuresFound = 0;
        let itemsInGame = [];

        // Helper function to use new TTS via parent window
        function speak(text, options = {}) {
            // Try to use parent window TTS (new system)
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'html-game-tts',
                    text: text,
                    volume: options.volume || 1.0,
                    rate: options.rate || 0.9,
                    pitch: options.pitch || 1.1
                }, '*');
            } else {
                // Fallback to browser TTS if not in iframe
                const synth = window.speechSynthesis;
                if (synth.speaking) synth.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.pitch = options.pitch || 1.1;
                u.rate = options.rate || 1.0;
                u.volume = options.volume || 1.0;
                synth.speak(u);
            }
        }

        function initGame() {
            const grid = document.getElementById('tomb-container');
            grid.innerHTML = '';
            document.getElementById('win-screen').classList.remove('show');
            document.getElementById('score-count').innerText = '0';
            stopConfetti();
            treasuresFound = 0;

            // setup the 12 items for this round (3 treasures, 9 dust)
            itemsInGame = [];
            // Get only treasure types first
            const treasuresOnly = possibleItems.filter(i => i.type === 'treasure');
            // Shuffle and pick 3
            treasuresOnly.sort(() => Math.random() - 0.5);
            itemsInGame.push(treasuresOnly[0], treasuresOnly[1], treasuresOnly[2]);
            
            // Add 9 dust items
            const dustOnly = possibleItems.filter(i => i.type === 'dust');
            // Shuffle dust items and pick 9
            dustOnly.sort(() => Math.random() - 0.5);
            for(let i = 0; i < 9; i++) {
                itemsInGame.push(dustOnly[i % dustOnly.length]);
            }

            // Shuffle the final 12 positions
            itemsInGame.sort(() => Math.random() - 0.5);

            // Create the 12 spots
            for(let i=0; i<12; i++) {
                createSpot(i, containers[i]);
            }
        }

        function createSpot(index, containerIcon) {
            const grid = document.getElementById('tomb-container');
            const spot = document.createElement('div');
            spot.className = 'hiding-spot';
            spot.dataset.index = index;

            // The container icon (visible initially)
            const containerEl = document.createElement('div');
            containerEl.className = 'container-icon spot-content';
            containerEl.innerText = containerIcon;
            
            spot.appendChild(containerEl);

            spot.onclick = () => revealSpot(spot);
            grid.appendChild(spot);
        }

        function revealSpot(spotEl) {
            if(spotEl.classList.contains('revealed')) return; // Already clicked

            spotEl.classList.add('revealed');
            const index = spotEl.dataset.index;
            const item = itemsInGame[index];

            // 1. Animate container shaking before opening
            spotEl.classList.add('shake');

            setTimeout(() => {
                spotEl.classList.remove('shake');
                
                // 2. Show content
                const contentEl = document.createElement('div');
                contentEl.className = 'spot-content reveal-anim';
                contentEl.innerText = item.icon;
                spotEl.appendChild(contentEl);

                // 3. Speak feedback
                speak(item.name);

                // 4. Score logic
                if(item.type === 'treasure') {
                    treasuresFound++;
                    document.getElementById('score-count').innerText = treasuresFound;
                    spotEl.style.backgroundColor = '#FFF9C4'; // Light yellow highlight
                    
                    if(treasuresFound === 3) {
                        setTimeout(winGame, 1000);
                    }
                } else {
                     spotEl.style.backgroundColor = '#D7CCC8'; // Dusty gray highlight
                }
            }, 300); // wait for shake to finish
        }


        function winGame() {
            speak("Hooray! You found all the Pharaoh's treasures!");
            document.getElementById('win-screen').classList.add('show');
            startConfetti();
            
            // Notify parent window that game is completed
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'html-game-complete', game: 'ancient-egypt-pyramids-pharaohs' }, '*');
            }
        }

        // --- CONFETTI ---
        let confettiInterval;
        function startConfetti() {
            const c = document.getElementById('confetti');
            const ctx = c.getContext('2d');
            c.width = window.innerWidth;
            c.height = window.innerHeight;
            let p = [];
            for(let i=0; i<80; i++) p.push({
                x: Math.random()*c.width, y: -20, 
                color: ['#FFD700', '#DAA520', '#FFFFFF', '#00BFFF'][Math.floor(Math.random()*4)],
                size: Math.random()*10+5, speed: Math.random()*5+2
            });

            confettiInterval = setInterval(() => {
                ctx.clearRect(0,0,c.width,c.height);
                p.forEach(o => {
                    ctx.fillStyle = o.color;
                    ctx.fillRect(o.x, o.y, o.size, o.size);
                    o.y += o.speed;
                    if(o.y > c.height) o.y = -20;
                });
            }, 20);
        }
        function stopConfetti() { clearInterval(confettiInterval); }

        window.onload = initGame;
    </script>
</body>
</html>
